{% extends "base.html" %}

{% block title %}Detalle del Partido{% endblock %}

{% block content %}
<style>
    .btn {
        display: inline-block;
        font-weight: 400;
        color: #212529;
        text-align: center;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        background-color: transparent;
        border: 1px solid transparent;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        border-radius: 0.25rem;
        text-decoration: none;
        transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    .btn-primary {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
    }
    .btn-danger {
        color: #fff;
        background-color: #dc3545;
        border-color: #dc3545;
    }
    .btn-warning {
        color: #212529;
        background-color: #ffc107;
        border-color: #ffc107;
    }
    .btn-success {
        color: #fff;
        background-color: #28a745;
        border-color: #28a745;
    }
    .btn-lg {
        padding: 0.5rem 1rem;
        font-size: 1.25rem;
        line-height: 1.5;
        border-radius: 0.3rem;
    }
</style>
    <h1>{{ partido.nombre_cancha }}</h1>
    <p><strong>Ubicación:</strong> {{ partido.ubicacion }}</p>
    <p><strong>Fecha:</strong> {{ partido.fecha.strftime('%d/%m/%Y a las %H:%M') }} hs</p>
    <p><strong>Cupos:</strong> {{ partido.jugadores_inscritos|length }} / {{ partido.jugadores_necesarios }}</p>
    <hr>
    <h3>Jugadores Inscritos:</h3>
    <ul style="list-style-type: circle; padding-left: 20px;">
        {% for jugador in partido.jugadores_inscritos %}
            <li>{{ jugador.nombre }} {{ jugador.apellido }}</li>
        {% else %}
            <li>Nadie se ha inscrito todavía.</li>
        {% endfor %}
    </ul>

    <hr>
    
    <!-- Lógica de botones para usuarios autenticados -->
    {% if current_user.is_authenticated %}
        
        <!-- Si el usuario está inscrito en el partido -->
        {% if current_user in partido.jugadores_inscritos %}
            
            <!-- Si el partido ya pasó, puede calificar -->
            {% if partido_pasado %}
                <div style="text-align: center; margin: 20px 0;">
                    <a href="{{ url_for('calificar_partido', partido_id=partido.id) }}" class="btn btn-warning btn-lg">
                        Calificar Jugadores
                    </a>
                </div>
            <!-- Si el partido es a futuro, puede darse de baja -->
            {% else %}
                <form action="{{ url_for('darse_de_baja', partido_id=partido.id) }}" method="POST" style="text-align: center;">
                    <button type="submit" class="btn btn-danger">Darse de baja</button>
                </form>
            {% endif %}

        <!-- Si el usuario NO está inscrito -->
        {% else %}
            <!-- Y si hay cupo y el partido no ha pasado, puede inscribirse -->
            {% if partido.jugadores_inscritos|length < partido.jugadores_necesarios and not partido_pasado %}
                <div style="text-align: center; margin-top: 20px;">
                    <h3 style="margin-bottom: 10px;">Inscribirse al partido</h3>
                    <form action="{{ url_for('inscribir_jugador', partido_id=partido.id) }}" method="POST">
                        <button type="submit" class="btn btn-primary btn-lg">¡Inscribirme ahora!</button>
                    </form>
                </div>
            <!-- Si no hay cupo -->
            {% elif partido.jugadores_inscritos|length >= partido.jugadores_necesarios %}
                 <h3 style="text-align: center;">¡Partido completo!</h3>
            {% endif %}
        {% endif %}

    <!-- Si el usuario no está autenticado -->
    {% else %}
        <p style="text-align: center; font-style: italic;"><a href="{{ url_for('login') }}">Inicia sesión</a> para poder inscribirte.</p>
    {% endif %}

    <!-- Botón para armar equipos (siempre visible si hay suficientes jugadores) -->
    {% if partido.jugadores_inscritos|length >= 2 %}
        <div style="text-align: center; margin: 20px 0;">
            <a href="{{ url_for('organizar_partido', partido_id=partido.id) }}" class="btn btn-success btn-lg">
                Armar Equipos Balanceados
            </a>
        </div>
    {% endif %}

{% endblock %}